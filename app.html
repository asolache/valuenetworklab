<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Value Network Lab Mapper â€“ Prototipado RÃ¡pido de Redes de Valor</title>
  <meta name="description" content="Herramienta interactiva para crear mapas de redes de valor con VNA. Dibuja, exporta y comparte tus redes en minutos. Compatible con Miro, Draw.io o ValueNetworks.com." />
  
  <!-- Favicon -->
  <link rel="icon" href="image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>V</text></svg>" type="image/svg+xml">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#003366',
            secondary: '#F97316',
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .canvas-container {
      border: 2px dashed #cbd5e1;
      border-radius: 0.5rem;
      min-height: 400px;
      background: #f8fafc;
      position: relative;
      overflow: hidden;
    }
    .draggable {
      cursor: move;
      position: absolute;
      z-index: 10;
    }
    .connector {
      stroke: #003366;
      stroke-width: 2;
      fill: none;
    }
    .intangible {
      stroke-dasharray: 5,5;
      stroke: #F97316;
    }
    textarea {
      width: 100%;
      height: 300px;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
    }
    #network-svg {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      width: 100%;
      min-height: 400px;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- Header con menÃº global -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-4xl mx-auto px-4 py-3 flex flex-wrap justify-between items-center gap-4">
      <a href="index.html" class="font-bold text-xl text-primary">Value Network Lab</a>
      <nav class="flex flex-wrap gap-4 md:gap-6 text-sm md:text-base">
        <a href="abstract.html" class="menu-link text-gray-700 hover:text-primary transition">Abstract</a>
        <a href="caso-de-uso.html" class="menu-link text-gray-700 hover:text-primary transition">Caso de Uso</a>
        <a href="formacion-accion.html" class="menu-link text-gray-700 hover:text-primary transition">FormaciÃ³n-AcciÃ³n</a>
        <a href="quienes-somos.html" class="menu-link text-gray-700 hover:text-primary transition">QuiÃ©nes Somos</a>
        <a href="contacto.html" class="menu-link text-gray-700 hover:text-primary transition">Contacto</a>
        <a href="https://cursovna.netlify.app/" class="bg-primary text-white px-3 py-1 rounded font-medium hover:bg-blue-800 transition">Curso VNA</a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-4 py-12">
    <h1 class="text-3xl md:text-4xl font-bold text-primary mb-6">Value Network Lab Mapper</h1>
    <p class="mb-6">Dibuja tu primera red de valor en minutos â€”sin herramientas complejas.</p>

    <section class="mb-10 bg-white p-6 rounded-lg shadow">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Editor de texto -->
        <div>
          <h2 class="text-xl font-bold text-primary mb-4">âœï¸ Editor de Transacciones</h2>
          <div class="bg-blue-50 p-4 rounded-lg mb-4">
            <p class="mb-2"><strong>Formato:</strong> Una lÃ­nea por transacciÃ³n</p>
            <p class="font-mono mb-2"><code>Origen â†’ Destino | tipo | Entregable</code></p>
            <p class="mb-2">Tipo: <code>tangible</code> o <code>intangible</code></p>
            <p class="italic text-sm">Ejemplos:</p>
            <ul class="list-none text-sm space-y-1 mt-1">
              <li><code>Cliente â†’ Vendedor | tangible | Pedido</code></li>
              <li><code>Vendedor â†’ Cliente | intangible | Confianza</code></li>
              <li><code>IT â†’ Marketing | tangible | Informe de uso web</code></li>
              <li><code>Marketing â†’ IT | intangible | Feedback de campaÃ±a</code></li>
            </ul>
          </div>
          
          <textarea id="input" placeholder="Cliente â†’ Vendedor | tangible | Pedido&#10;Vendedor â†’ DiseÃ±ador | intangible | Feedback&#10;DiseÃ±ador â†’ Cliente | tangible | Producto"></textarea>
          
          <div class="mt-4 flex flex-col sm:flex-row gap-3">
            <button onclick="drawNetwork()" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-800 transition flex-1">
              ğŸ¨ Dibujar Red de Valor
            </button>
            <button onclick="exportSVG()" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300 transition flex-1">
              ğŸ’¾ Exportar SVG
            </button>
          </div>
        </div>
        
        <!-- Vista grÃ¡fica -->
        <div>
          <h2 class="text-xl font-bold text-primary mb-4">ğŸ“Š Vista GrÃ¡fica de tu Red</h2>
          <div id="svg-container">
            <svg id="network-svg" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg"></svg>
          </div>
        </div>
      </div>
      
      <div class="mt-6 p-3 bg-gray-50 rounded border border-gray-200">
        <p class="text-sm mb-2">
          <strong>ğŸ’¡ Consejo rÃ¡pido:</strong> En VNA las flechas continuas representan entregables <span class="text-primary font-medium">tangibles (MUST)</span> y las discontinuas, entregables <span class="text-secondary font-medium">intangibles (EXTRA)</span>.
        </p>
        <p class="text-xs text-gray-500">
          Esta herramienta guarda temporalmente tu mapa en el navegador. Para guardar permanentemente, usa "Exportar SVG" o toma una captura de pantalla.
        </p>
      </div>
    </section>

    <!-- Consejos prÃ¡cticos -->
    <section class="mb-10 p-5 bg-gradient-to-r from-emerald-50 to-green-50 rounded-lg">
      <h2 class="text-2xl font-bold text-emerald-800 mb-3">ğŸ’¡ Consejos para mapear tu red</h2>
      <ul class="list-disc pl-5 space-y-2">
        <li><strong>Empieza pequeÃ±o:</strong> Selecciona un proceso o actividad concreta (ej. "venta de servicio complejo").</li>
        <li><strong>LÃ­mite de roles:</strong> Para tu primer mapa, usa entre 6 y 12 roles reales (personas, equipos o entidades externas).</li>
        <li><strong>Entregables observables:</strong> Describe entregables con sustantivos especÃ­ficos ("informe", "acuerdo", "visibilidad"), nunca con verbos ("colaborar").</li>
        <li><strong>Intangibles crÃ­ticos:</strong> Las flechas discontinuas (intangibles) suelen revelar los mayores puntos de mejora.</li>
      </ul>
    </section>

    <div class="text-center bg-gradient-to-r from-primary to-blue-800 text-white p-8 rounded-lg">
      <h3 class="text-2xl font-bold mb-4">Â¿Listo para mapear tu red de valor?</h3>
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <a href="https://cursovna.netlify.app/" class="bg-white text-primary font-bold py-3 px-8 rounded-lg hover:bg-gray-100 transition">ğŸ“ Accede al curso</a>
        <a id="contact-link" href="#" class="bg-secondary text-white font-bold py-3 px-8 rounded-lg hover:bg-orange-600 transition">ğŸ“§ Solicite apoyo</a>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-6 text-center text-sm">
    <p>
      Value Network Lab â€“ Inspirado en Verna Allee y 
      <a href="pantheon-work.html" class="text-secondary hover:underline">Pantheon Work</a>
    </p>
  </footer>

  <!-- Script para funcionalidad interactiva -->
  <script>
    // Proteger email
    document.getElementById('contact-link').href = 'mailto:' + ['a', 's', 'o', 'l', 'a', 'c', 'h', 'e', '@', 'm', 'a', 'c', '.', 'c', 'o', 'm'].join('');

    // Resaltar enlace activo
    document.querySelectorAll('.menu-link').forEach(link => {
      const currentPath = window.location.pathname.split('/').pop();
      const linkPath = new URL(link.href, window.location.origin).pathname.split('/').pop();
      
      if (currentPath === linkPath || (currentPath === '' && linkPath === 'index.html')) {
        link.classList.add('text-primary', 'font-semibold', 'border-b-2', 'border-primary');
      }
    });

    // Mapper interactivo de redes de valor
    function drawNetwork() {
      const svg = document.getElementById('network-svg');
      svg.innerHTML = '';

      const input = document.getElementById('input').value;
      if (!input.trim()) return;

      const lines = input.trim().split('\n');
      const nodes = new Set();
      const links = [];

      // Parsear lÃ­neas
      for (let line of lines) {
        line = line.trim();
        if (!line || line.startsWith('#')) continue;

        const parts = line.split('|').map(p => p.trim());
        if (parts.length !== 3) continue;

        const roles = parts[0].split('â†’').map(r => r.trim());
        if (roles.length !== 2) continue;

        const source = roles[0];
        const target = roles[1];
        const type = parts[1].toLowerCase();
        const deliverable = parts[2];

        if (!['tangible', 'intangible'].includes(type)) continue;

        nodes.add(source);
        nodes.add(target);
        links.push({ source, target, type, deliverable });
      }

      const nodeArray = Array.from(nodes);
      const nodeCount = nodeArray.length;
      if (nodeCount === 0) return;

      // Posicionar nodos en cÃ­rculo
      const centerX = 400;
      const centerY = 300;
      const radius = Math.min(250, 150 + nodeCount * 15);

      const positions = {};
      nodeArray.forEach((node, i) => {
        const angle = (i / nodeCount) * 2 * Math.PI - Math.PI / 2;
        positions[node] = {
          x: centerX + radius * Math.cos(angle),
          y: centerY + radius * Math.sin(angle)
        };
      });

      // Dibujar enlaces (flechas)
      links.forEach(link => {
        const start = positions[link.source];
        const end = positions[link.target];
        if (!start || !end) return;

        // Calcular desplazamiento para evitar superposiciÃ³n (simple)
        const dx = end.x - start.x;
        const dy = end.y - start.y;
        const len = Math.sqrt(dx*dx + dy*dy);
        const normX = dx / len;
        const normY = dy / len;

        const arrowStartX = start.x + 40 * normX;
        const arrowStartY = start.y + 40 * normY;
        const arrowEndX = end.x - 40 * normX;
        const arrowEndY = end.y - 40 * normY;

        // Flecha
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", arrowStartX);
        line.setAttribute("y1", arrowStartY);
        line.setAttribute("x2", arrowEndX);
        line.setAttribute("y2", arrowEndY);
        line.setAttribute("stroke", link.type === 'tangible' ? '#003366' : '#F97316');
        line.setAttribute("stroke-width", "2");
        if (link.type === 'intangible') {
          line.setAttribute("stroke-dasharray", "6,4");
        }

        // Flecha punta
        const headLen = 12;
        const angle = Math.atan2(arrowEndY - arrowStartY, arrowEndX - arrowStartX);
        const headX1 = arrowEndX - headLen * Math.cos(angle - Math.PI / 6);
        const headY1 = arrowEndY - headLen * Math.sin(angle - Math.PI / 6);
        const headX2 = arrowEndX - headLen * Math.cos(angle + Math.PI / 6);
        const headY2 = arrowEndY - headLen * Math.sin(angle + Math.PI / 6);

        const head = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
        head.setAttribute("points", `${arrowEndX},${arrowEndY} ${headX1},${headY1} ${headX2},${headY2}`);
        head.setAttribute("fill", link.type === 'tangible' ? '#003366' : '#F97316');

        svg.appendChild(line);
        svg.appendChild(head);

        // Etiqueta del entregable
        const midX = (arrowStartX + arrowEndX) / 2;
        const midY = (arrowStartY + arrowEndY) / 2;
        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", midX);
        text.setAttribute("y", midY - 8);
        text.setAttribute("font-family", "'Inter', sans-serif");
        text.setAttribute("font-size", "12");
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("fill", "#374151");
        text.textContent = link.deliverable;
        svg.appendChild(text);
      });

      // Dibujar nodos
      nodeArray.forEach(node => {
        const pos = positions[node];
        if (!pos) return;
        
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", pos.x);
        circle.setAttribute("cy", pos.y);
        circle.setAttribute("r", "35");
        circle.setAttribute("fill", "#dbeafe");
        circle.setAttribute("stroke", "#003366");
        circle.setAttribute("stroke-width", "2");
        svg.appendChild(circle);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", pos.x);
        text.setAttribute("y", pos.y + 4);
        text.setAttribute("font-family", "'Inter', sans-serif");
        text.setAttribute("font-size", "14");
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("fill", "#003366");
        text.setAttribute("font-weight", "600");
        
        // Ajustar texto largo
        const words = node.split(' ');
        if (words.length === 1) {
          text.textContent = node;
        } else {
          const tspan1 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
          tspan1.setAttribute("x", pos.x);
          tspan1.setAttribute("dy", "-0.4em");
          tspan1.textContent = words[0];
          const tspan2 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
          tspan2.setAttribute("x", pos.x);
          tspan2.setAttribute("dy", "1.2em");
          tspan2.textContent = words.slice(1).join(' ');
          text.appendChild(tspan1);
          text.appendChild(tspan2);
        }
        svg.appendChild(text);
      });
    }

    function exportSVG() {
      const svg = document.getElementById('network-svg');
      const svgData = new XMLSerializer().serializeToString(svg);
      const svgBlob = new Blob([svgData], {type:"image/svg+xml;charset=utf-8"});
      const svgUrl = URL.createObjectURL(svgBlob);
      
      const downloadLink = document.createElement("a");
      downloadLink.href = svgUrl;
      downloadLink.download = "red-valor-" + new Date().toISOString().slice(0,10) + ".svg";
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
    }

    // Dibujar al cargar
    window.onload = () => {
      // Cargar datos predefinidos si el textarea estÃ¡ vacÃ­o
      if (!document.getElementById('input').value.trim()) {
        document.getElementById('input').value = 
          "Cliente â†’ Vendedor | tangible | Pedido\n" +
          "Vendedor â†’ Cliente | intangible | Confianza\n" +
          "Vendedor â†’ Marketing | tangible | Datos de cliente\n" +
          "Marketing â†’ Cliente | intangible | Conocimiento de mercado\n" +
          "Vendedor â†’ IT | tangible | Requerimientos\n" +
          "IT â†’ Vendedor | intangible | Soporte tÃ©cnico\n" +
          "Marketing â†’ IT | tangible | Especificaciones\n" +
          "IT â†’ Marketing | intangible | Feedback tÃ©cnico";
      }
      drawNetwork();
    };
  </script>
</body>
</html>
