<!DOCTYPE html>
<html lang="es">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <title>VNA Mapper – Value Network Lab</title>
 <style>
   body {
     font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
     margin: 0;
     padding: 20px;
     background: #f9fafb;
     color: #111827;
   }
   h1 {
     color: #1e40af;
     text-align: center;
     margin-bottom: 1rem;
   }
   .container {
     max-width: 1200px;
     margin: 0 auto;
     display: grid;
     grid-template-columns: 1fr 2fr;
     gap: 20px;
   }
   textarea {
     width: 100%;
     height: 400px;
     padding: 12px;
     border: 1px solid #d1d5db;
     border-radius: 8px;
     font-family: monospace;
     font-size: 14px;
   }
   .instructions {
     background: #f0f9ff;
     padding: 12px;
     border-radius: 8px;
     margin-bottom: 12px;
     font-size: 0.9rem;
   }
   svg {
     background: white;
     border: 1px solid #e5e7eb;
     border-radius: 8px;
     width: 100%;
     min-height: 400px;
   }
   button {
     background: #1e40af;
     color: white;
     border: none;
     padding: 10px 16px;
     border-radius: 6px;
     font-weight: 600;
     cursor: pointer;
     margin-top: 10px;
   }
   button:hover {
     background: #1d4ed8;
   }
   @media (max-width: 900px) {
     .container {
       grid-template-columns: 1fr;
     }
   }
 </style>
</head>
<body>
 <h1>Value Network Lab Mapper – Dibuja tu red de valor</h1>


 <div class="container">
   <div>
     <div class="instructions">
       <p><strong>Formato:</strong> Una línea por transacción</p>
       <p><code>Origen → Destino | tipo | Entregable</code></p>
       <p>Tipo: <code>tangible</code> o <code>intangible</code></p>
       <p>Ejemplo:</p>
       <p><code>Cliente → Vendedor | tangible | Pedido</code><br>
       <code>Vendedor → Cliente | intangible | Confianza</code></p>
     </div>
     <textarea id="input" placeholder="Cliente → Vendedor | tangible | Pedido&#10;Vendedor → Diseñador | intangible | Feedback&#10;Diseñador → Cliente | tangible | Producto"></textarea>
     <br>
     <button onclick="drawNetwork()">Dibujar red de valor</button>
   </div>


   <div>
     <div id="svg-container">
       <svg id="network-svg" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg"></svg>
     </div>
   </div>
 </div>


 <script>
   function drawNetwork() {
     const svg = document.getElementById('network-svg');
     svg.innerHTML = '';


     const input = document.getElementById('input').value;
     if (!input.trim()) return;


     const lines = input.trim().split('\n');
     const nodes = new Set();
     const links = [];


     // Parsear líneas
     for (let line of lines) {
       line = line.trim();
       if (!line || line.startsWith('#')) continue;


       const parts = line.split('|').map(p => p.trim());
       if (parts.length !== 3) continue;


       const roles = parts[0].split('→').map(r => r.trim());
       if (roles.length !== 2) continue;


       const source = roles[0];
       const target = roles[1];
       const type = parts[1].toLowerCase();
       const deliverable = parts[2];


       if (!['tangible', 'intangible'].includes(type)) continue;


       nodes.add(source);
       nodes.add(target);
       links.push({ source, target, type, deliverable });
     }


     const nodeArray = Array.from(nodes);
     const nodeCount = nodeArray.length;
     if (nodeCount === 0) return;


     // Posicionar nodos en círculo
     const centerX = 400;
     const centerY = 300;
     const radius = Math.min(250, 150 + nodeCount * 15);


     const positions = {};
     nodeArray.forEach((node, i) => {
       const angle = (i / nodeCount) * 2 * Math.PI - Math.PI / 2;
       positions[node] = {
         x: centerX + radius * Math.cos(angle),
         y: centerY + radius * Math.sin(angle)
       };
     });


     // Dibujar enlaces (flechas)
     links.forEach(link => {
       const start = positions[link.source];
       const end = positions[link.target];
       if (!start || !end) return;


       // Calcular desplazamiento para evitar superposición (simple)
       const dx = end.x - start.x;
       const dy = end.y - start.y;
       const len = Math.sqrt(dx*dx + dy*dy);
       const normX = dx / len;
       const normY = dy / len;


       const arrowStartX = start.x + 40 * normX;
       const arrowStartY = start.y + 40 * normY;
       const arrowEndX = end.x - 40 * normX;
       const arrowEndY = end.y - 40 * normY;


       // Flecha
       const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
       line.setAttribute("x1", arrowStartX);
       line.setAttribute("y1", arrowStartY);
       line.setAttribute("x2", arrowEndX);
       line.setAttribute("y2", arrowEndY);
       line.setAttribute("stroke", link.type === 'tangible' ? '#1e40af' : '#10b981');
       line.setAttribute("stroke-width", "2");
       if (link.type === 'intangible') {
         line.setAttribute("stroke-dasharray", "6,4");
       }


       // Flecha punta
       const headLen = 12;
       const angle = Math.atan2(arrowEndY - arrowStartY, arrowEndX - arrowStartX);
       const headX1 = arrowEndX - headLen * Math.cos(angle - Math.PI / 6);
       const headY1 = arrowEndY - headLen * Math.sin(angle - Math.PI / 6);
       const headX2 = arrowEndX - headLen * Math.cos(angle + Math.PI / 6);
       const headY2 = arrowEndY - headLen * Math.sin(angle + Math.PI / 6);


       const head = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
       head.setAttribute("points", `${arrowEndX},${arrowEndY} ${headX1},${headY1} ${headX2},${headY2}`);
       head.setAttribute("fill", link.type === 'tangible' ? '#1e40af' : '#10b981');


       svg.appendChild(line);
       svg.appendChild(head);


       // Etiqueta del entregable
       const midX = (arrowStartX + arrowEndX) / 2;
       const midY = (arrowStartY + arrowEndY) / 2;
       const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
       text.setAttribute("x", midX);
       text.setAttribute("y", midY - 8);
       text.setAttribute("font-family", "sans-serif");
       text.setAttribute("font-size", "12");
       text.setAttribute("text-anchor", "middle");
       text.setAttribute("fill", "#374151");
       text.textContent = link.deliverable;
       svg.appendChild(text);
     });


     // Dibujar nodos
     nodeArray.forEach(node => {
       const pos = positions[node];
       const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
       circle.setAttribute("cx", pos.x);
       circle.setAttribute("cy", pos.y);
       circle.setAttribute("r", "40");
       circle.setAttribute("fill", "#dbeafe");
       circle.setAttribute("stroke", "#1e40af");
       circle.setAttribute("stroke-width", "2");
       svg.appendChild(circle);


       const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
       text.setAttribute("x", pos.x);
       text.setAttribute("y", pos.y + 4);
       text.setAttribute("font-family", "sans-serif");
       text.setAttribute("font-size", "14");
       text.setAttribute("text-anchor", "middle");
       text.setAttribute("fill", "#1e40af");
       text.setAttribute("font-weight", "600");
       // Ajustar texto largo
       const words = node.split(' ');
       if (words.length === 1) {
         text.textContent = node;
       } else {
         const tspan1 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
         tspan1.setAttribute("x", pos.x);
         tspan1.setAttribute("dy", "-0.4em");
         tspan1.textContent = words[0];
         const tspan2 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
         tspan2.setAttribute("x", pos.x);
         tspan2.setAttribute("dy", "1.2em");
         tspan2.textContent = words.slice(1).join(' ');
         text.appendChild(tspan1);
         text.appendChild(tspan2);
       }
       svg.appendChild(text);
     });
   }


   // Dibujar al cargar
   window.onload = () => {
     drawNetwork();
   };
 </script>
</body>
</html>

